# 寻路算法

## 差速驱动理论

定义
![](http://latex.codecogs.com/gif.latex?w_l,w_r) 分别为左右轮的转速，![](http://latex.codecogs.com/gif.latex?w(t)=(w_l(t),w_r(t))\\in[-1,1]^2)，则有![](http://latex.codecogs.com/gif.latex?v=\\frac{1}{2}(w_l+w_r),\\omega=\\frac{1}{2b}(w_r-w_l).)

可以证明，在不考虑加速度上限的情况下，最优路径只包括原地转弯和直线行进（前进或后退）[1]. 

## 前往目标的策略

根据理论，暂时不考虑「边转边走」的策略。这样![](http://latex.codecogs.com/gif.latex?w) 应该只有五种可能的取值： ![](http://latex.codecogs.com/gif.latex?(0,0),(1,1),(-1,-1),(1,-1),(-1,1)) ，分别对应于停止、前进（或后退过程中的制动）、后退（或前进过程中的制动）、右转、左转。

小标题中的【目标】包括了规则中的【目标点】和【道具】，或【场地中心】。

1. 小车当前处于静止状态：顺时针或逆时针旋转一个不大于 ![](http://latex.codecogs.com/gif.latex?\\frac{\\pi}{2}) 的角度，用**车头或车尾**瞄准目标点，然后向前或向后驶向目标点。
2. 小车当前处于行进状态：
    1. 目标位置发生了变化：立即停车，转入 1.
    2. 因之前旋转时的误差，导致当前方向与目标方向不一致：
        1. 如果目标是道具：计算当前路径到道具的距离. 如果距离不大于官方规定的误差容限，不作处理；否则立即停车，转入 1.
        2. 如果目标是目标点：
            1. 简单的方法：考虑到只要离目标点较近即视作占点，先不作处理行驶到目标点在当前路径到投影位置，再作直角转弯.
            2. 复杂的方法：用实验方法测量【前进单位距离的时间开销】、【旋转单位角度的时间开销】、【制动的距离和时间开销】后，给出更精细的策略.（待定）
        3. 如果目标是场地中心：不作处理.

## 选择目标的策略（草案）
- 一些记号：
    + 本方小车： A
    + 对方小车： B
    + 目标点： G
    + 道具： P
    + 场地中心： C
    + 【黑白颠倒】道具：🎹
    + 【制空权】道具：✈️
    + 【恢复生命】道具：🍎
- ![](http://latex.codecogs.com/gif.latex?d(X,Y),X\\in\\{A,B\\},Y\\in\\{G,P,C\\})定义为主体 X 从当前状态到位置 Y 所需的【前进、旋转、制动】时间开销之和. ![](http://latex.codecogs.com/gif.latex?d(X,Y_1,Y_2),X\\in\\{A,B\\},Y_1,Y_2\\in\\{G,P,C\\}) 定义为主体 X 从当前状态【经由位置 Y1 到达位置 Y2】所需的【前进、旋转、制动】时间开销之和. 由于对方的朝向及其小车的具体参数无从而知，需要进行适当的估算.
- 在【非占点】状态下，以目标点作为目标，除非：
    + 当前道具为 🎹，且 ![](http://latex.codecogs.com/gif.latex?d(A,G)\\geq d(B,G),d(A,P)\\leq d(B,P))，以道具作为目标.
    + 当前道具为 ✈ 或 🍎 ️，且 ![](http://latex.codecogs.com/gif.latex?d(A,P,G)\\leq d(B,G))，以道具作为目标.
- 在【占点】状态下：
    + 若当前道具为 🍎 ️，且 ![](http://latex.codecogs.com/gif.latex?d(A,P,G)\\leq d(B,G))，以道具作为目标.
    + 若当前道具为 ✈️ ，且 ![](http://latex.codecogs.com/gif.latex?d(A,P)\\leq d(B,P))，以道具作为目标.
    + 若当前道具为 ✈ 或 🍎 ️，且不满足上面两个条件，调整方向，将车头或车尾指向道具.
    + 若当前没有道具，调整方向，将车头或车尾指向场地中心.
- 在【目标点冷却期】：
    + 若当前道具为 ✈ 或 🍎，以道具作为目标.
    + 否则以场地中心作为目标.

## 待解决的问题

- 上面的策略中对场地的颜色没有判断，这在大多数情况下应该问题不大. 但须考虑一种特殊情况：目标点位于两种颜色的边界附近，此时应避免进入目标点邻域中与目标点不同色的部分.
- 对 ✈️ 处于攻击和治疗状态下的价值没有区分. 可能需要定义更加精细的价值函数.

[1]: Balkcom, D. J., & Mason, M. T. (2001). Graphical Construction of Time Optimal Trajectories for Differential Drive Robots. Algorithmic and Computational Robotics: New Directions, 377–390.
